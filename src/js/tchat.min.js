//! wow what a nerd
(function(k,f){window.tchat={currentChannel:{id:null},notifs:!1};window.tchat.channel=function(p,q){function l(a){if((13===a.which||13===a.keyCode)&&""!==e.value){if(firebase.auth().currentUser){var c=e.value;a=firebase.database().ref().child("chat/channels/"+tchat.currentChannel.id).child("msgs");c={edited:!1,from:firebase.auth().currentUser.uid,msg:c,timestamp:Number(Date.now())};a.push().set(c);g()}else f.toast("You\u2019re not logged in. Log in to send chats.",3E3);e.value=""}}function r(a){return a.replace(/[<>]/g,
function(a){return{"<":"&lt;",">":"&gt;"}[a]})}function m(a){var c=a.msg,d=firebase.database().ref("/users/"+a.from);a.msg=r(a.msg);a.msg=a.msg.replace(/[-a-zA-Z0-9@:%_\+.~#?&/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi,function(a){var b=document.createElement("a");a.startsWith("http://")||a.startsWith("https://")?b.href=a:b.href="//"+a;b.innerHTML=a;b.target="_blank";return b.outerHTML});a.msg=a.msg.replace(/\*\b(\S[\s\S]*?)\b\*/gi,function(a,c){var b=document.createElement("strong");
b.innerHTML=c;return b.outerHTML});a.msg=a.msg.replace(/\b_(\S[\s\S]*?)_\b/gi,function(a,c){var b=document.createElement("em");b.innerHTML=c;return b.outerHTML});return d.once("value").then(function(b){b=b.val();return{name:b.username,msg:a.msg,user:b,data:a,raw:c}}).then(function(a){var b=Number(a.data.timestamp)>Number(tchat.loadedTime);!document.hasFocus()&&!0===tchat.notifs&&b&&navigator.serviceWorker.ready.then(function(b){b.showNotification(a.name||"New message",{body:c,icon:a.user.photo,badge:"https://benji.pw/assets/icons/t.png",
vibrate:[100,150,100],data:{id:"tchat",url:"https://benji.pw/tchat/"}})});return String(a.name+": "+a.msg)})}function g(){if(document.getElementById("tchat").classList.contains("active")){var a=document.getElementsByClassName("chat-container")[0];a.scrollTop=a.scrollHeight}}tchat.currentChannel.id=p.toLowerCase();var n=document.getElementById("list"),e=document.getElementById("chatTxt"),t=document.getElementById("chName"),h=firebase.database().ref().child("chat/channels/"+tchat.currentChannel.id),
d=h.child("msgs").orderByKey();!0===q&&f.toast("Switching to channel "+tchat.currentChannel.id+"&hellip;",1500);n.innerHTML="";e.removeEventListener("keypress",l);h.off("value");d.off("child_added");d.off("child_changed");d.off("child_removed");h.on("value",function(a){a=a.val();try{t.innerText=a.meta.name}catch(c){f.toast("That\u2019s not a valid channel. Switching to global&hellip;",3E3),tchat.channel("global")}});d.on("child_added",function(a){var c=document.createElement("li"),d=a.val();c.id=
"msg"+a.key;n.appendChild(c);m(d).then(function(a){c.innerHTML=a;g()})});d.on("child_changed",function(a){var c=document.getElementById("msg"+a.key);a=a.val();m(a).then(function(a){c.innerHTML=a})});d.on("child_removed",function(a){(a=document.getElementById("msg"+a.key))&&a.remove()});e.addEventListener("keypress",l);k(document).ready(function(){k("ul.tabs").tabs({onShow:g})})};tchat.channel("global",!1)})(jQuery,Materialize);
