!function(){"use strict";window.tchat={},window.tchat.channel=function(e,t){function n(e){return e.replace(/[&<>'"]/g,function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]})}function a(e,t){var n=m.push(),a={edited:!1,from:t,msg:e,timestamp:Number(Date.now())};n.set(a)}function o(e){var t=/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?/gi,a=/\b_(\S[\s\S]*?)_\b/gi,o=/(?:^| +)\*{1}(\S[\s\S]*?)\*{1}(?: +|$)/gi;return e.msg=n(e.msg),e.msg=e.msg.replace(t,function(e){var t=document.createElement("a"),n=Boolean(e.startsWith("http://")||e.startsWith("https://"));return n?t.href=e:t.href="//"+e,t.innerHTML=e,t.target="_blank",t.outerHTML}),e.msg=e.msg.replace(o,function(e,t){var n=document.createElement("strong");return n.innerHTML=t,n.outerHTML}),e.msg=e.msg.replace(a,function(e,t){var n=document.createElement("em");return n.innerHTML=t,n.outerHTML}),console.log(e.msg),""+e.from+": "+e.msg}function c(){if(document.getElementById("tchat").classList.contains("active")){var e=document.getElementsByClassName("chat-container")[0];e.scrollTop=e.scrollHeight}}e=e.toLowerCase()||"global";const i=document.getElementById("list"),r=document.getElementById("chatTxt"),l=document.getElementById("chName"),s=firebase.database().ref().child("chat/channels/"+e),m=s.child("msgs"),u=m.limitToLast(100);t===!0&&Materialize.toast("Switching to channel "+e+"&hellip;",3e3),i.innerHTML="",s.once("value").then(function(e){var t=e.val();try{l.innerText=t.meta.name}catch(n){Materialize.toast("That’s not a valid channel. Switching to global&hellip;",3e3),tchat.channel("global")}}),u.on("child_added",function(e){const t=document.createElement("li");t.id="msg"+e.key,t.innerHTML=o(e.val()),i.appendChild(t),c()}),u.on("child_changed",function(e){const t=document.getElementById("msg"+e.key);t.innerHTML=o(e.val())}),u.on("child_removed",function(e){const t=document.getElementById("msg"+e.key);t.remove()}),r.addEventListener("keypress",function(e){13!==e.which&&13!==e.keyCode||""===r.value||(firebase.auth().currentUser?a(r.value,firebase.auth().currentUser.displayName||"Anon."):Materialize.toast("You’re not logged in. Log in to send chats.",5e3),r.value="")});$(document).ready(function(){$("ul.tabs").tabs({onShow:c})})},tchat.channel("global",!1)}();
